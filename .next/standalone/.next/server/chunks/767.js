"use strict";exports.id=767,exports.ids=[767],exports.modules={261:(a,b,c)=>{c.d(b,{V:()=>g,a:()=>h});var d=c(7759),e=c(637),f=c(9369);let g=a=>{let{client_ip:b,location:c,user_agent:d,language:e}=JSON.parse((a.headers[f.R.userMetadata]??"")||"{}");return{userMetadata:{client_ip:b,location:c,user_agent:d,language:e}}},h=(a,b)=>({...(0,e.e)({event:a,data:void 0}),throw:d.A.isEnabledDebugMode?b:void 0})},444:(a,b,c)=>{c.d(b,{M:()=>d,z:()=>e});let d={account:!0},e={account:!0,sessions:!0}},637:(a,b,c)=>{c.d(b,{G:()=>d,e:()=>e});let d=a=>a,e=a=>a},1224:(a,b,c)=>{c.d(b,{Uq:()=>e,gC:()=>g,ot:()=>f});var d=c(8729);let e={pricing_plan:0,account_status:d.Nv.NOT_ACTIVE,payment_status:d.kr.UNPAID,gallery_config:{create:{records_traits:["Jednolite","Ombre","Magnetyczne","One Stroke","Wzorki","Naklejki"],records_color_traits:["Wielokolorowe","Czerwone","Niebieskie"]}}},f={pricing_plan:6,account_status:d.Nv.ACTIVE,payment_status:d.kr.PAID,gallery_config:{create:{records_traits:["Jednolite","Ombre","Magnetyczne","One Stroke","Wzorki","Naklejki"],records_color_traits:["Wielokolorowe","Czerwone","Niebieskie"]}}},g={pricing_plan:6,account_status:d.Nv.ACTIVE,payment_status:d.kr.PAID,gallery_config:{update:{records_traits:["Jednolite","Ombre","Magnetyczne","One Stroke","Wzorki","Naklejki"],records_color_traits:["Wielokolorowe","Czerwone","Niebieskie"]}}}},1314:(a,b,c)=>{c.d(b,{C$:()=>h,CX:()=>j,nn:()=>l,ph:()=>k,sZ:()=>i});var d=c(8729),e=c(2429),f=c(4062),g=c(6031);let h=async({session_id:a})=>await g.X.use.session.findUnique({where:{session_id:a}}),i=async()=>await g.X.use.session.findMany({orderBy:{last_used:"asc"}})??[],j=async(a,b=!0)=>await g.X.use.session.findMany({where:{created_by_user_id:a,session_mode:b?d.JW.STANDARD:void 0},orderBy:{last_used:"asc"}}),k=async(a,b)=>{try{if(!a||!b)return(0,e.BP)(()=>console.log("deleteSession_IO - no payload.",`session_id: ${!!a}, user_id: ${!!b}`)),null;return await g.X.use.session.delete({where:{session_id:a,created_by_user:{user_id:b}}})}catch(a){if(!a||"P2025"===a.code)return null;throw(0,f.O)("deleteSession",a),a}},l=async a=>{try{if(!a.payload)return(0,e.BP)(()=>console.log("deleteAllSessions_IO - no payload.",`props.payload: ${!!a.payload}`)),!1;return!!(await g.X.use.session.deleteMany({where:{created_by_user:{user_id:a.payload}}})).count}catch(a){throw(0,f.O)("deleteAllSessions_IO ERROR",a),a}}},1596:(a,b,c)=>{c.d(b,{CT:()=>i,V:()=>l,mx:()=>k,yh:()=>j});var d=c(2429),e=c(4062),f=c(5589),g=c(7512),h=c(9617);let i=a=>a?((0,d.BP)(()=>console.log("getFullSalt type: ",typeof f.h3.JWT_SALT," salt: ",a)),f.h3.JWT_SALT+a):void(0,e.O)("getFullSalt: NO SALT.",{salt:a,processSALT:f.h3.JWT_SALT}),j=a=>"object"==typeof a&&null!==a&&"user_id"in a,k=(a,b)=>a+h.u+b,l=a=>{try{let b=(a=>{try{let{encodedToken:b,salt:c}=(a=>{if(!a)throw Error("Unable to determine extended token from ExtendedToken");let b=a.indexOf(h.u),c=a.replace(h.u,""),e={encodedToken:c.substring(0,b),salt:c.substring(b)};return(0,d.BP)(()=>console.log("getEncodedTokenFromExtendedToken. type of encodedToken and salt: ",typeof e.encodedToken,typeof e.salt)),e})(a),e=(0,g.G)(b,c),f=j(e)?e:void 0;if(!f)return void(0,d.BP)(()=>console.log("getDecodedTokenFromExtendedToken validateTokenPayload FAIL. extendedToken: ",a));return f}catch(a){throw(0,e.O)("getDecodedTokenFromExtendedToken PASSED TOKEN IS INVALID OR EXPIRED",a),a}})(a);return{extendedToken:a,decodedToken:b}}catch(a){throw(0,e.O)("getDecodedTokenFromPassedExtended",a),a}}},1933:(a,b,c)=>{c.d(b,{_P:()=>l,if:()=>i,Jp:()=>k,t:()=>m,zO:()=>j});var d=c(483),e=c(4062),f=c(6923),g=c.n(f);let h=async a=>{let b=a?.client_ip;if(!b)return null;let c=await g().lookup(b);return c?`${c.country}, ${c.city}. Timezone: ${c.timezone}`:null},i=a=>{if(!a)return null;if(!a.password)return a;let{password:b,...c}=a;return c},j=(a,b)=>{let{permissions:c,...d}=a;return{...d,session:b.session}},k=(a,b)=>a===b,l=(a,b)=>!!a?.account&&!!b?.account&&a.account.account_id!==b.account.account_id,m=async a=>{let b={user_agent:a.user_agent,language:a.language,client_ip:a.client_ip,location:void 0};try{return b.location=await (0,d.handlePromiseWithTimeout)(h({client_ip:a.client_ip??void 0}))??void 0,b}catch(a){return(0,e.O)("fillUserMetadataWithLocation",a),b}}},2429:(a,b,c)=>{c.d(b,{BP:()=>e,XI:()=>f,kT:()=>g});var d=c(7759);let e=a=>{d.A.isEnabledDebugMode&&a()},f=a=>{d.A.isEnabledDBLeaksDebugger&&a()},g=(a,b)=>{console.log(""),console.log(""),console.log(""),console.log(" TEMPORARY DEBUGGING "),console.log(""),console.log(b.toUpperCase()),console.log(""),console.log(""),a(),console.log(""),console.log(""),console.log(" TEMPORARY DEBUGGING END"),console.log(""),console.log(""),console.log("")}},2562:(a,b,c)=>{c.d(b,{Hd:()=>r,dC:()=>v,i7:()=>q,iP:()=>x,lR:()=>y,mg:()=>u,td:()=>s,uQ:()=>t,w4:()=>w}),c(483);var d=c(6214),e=c(7223),f=c(1314),g=c(2429),h=c(4062),i=c(8729),j=c(4476),k=c(6289),l=c(444),m=c(1933),n=c(4205),o=c(6031),p=c(1775);let q=async a=>await (0,e.XQ)(a),r=async a=>{try{(0,g.BP)(()=>console.log("logoutUser fired.")),await (0,d.xN)(a)}catch(a){throw(0,h.O)("logoutUser_IO ERROR",a),a}},s=async a=>{let{payload:b}=a;try{(0,g.BP)(()=>console.log("logoutUser fired.")),await r(a),await (0,f.ph)(b?.session_id,b?.user_id)}catch(a){throw(0,h.O)("logoutUserAndDeleteSession_IO ERROR",a),a}},t={user:void 0,currentUser:void 0,sessionAndToken:void 0},u=async a=>{try{let b=await (0,e.h7)(a);if((0,g.BP)(()=>console.log("getCurrentUserByReqRes_IO sessionAndToken: ",b)),!b?.token||!b.token.decodedToken)return(0,g.BP)(()=>console.log("getCurrentUserByReqRes_IO NO TOKEN case.")),await r(a),t;{let a=await (0,n.Dt)({user_id:b.token.decodedToken.user_id},!0,!1,!0);if(!a)return t;return{user:a,currentUser:(0,m.zO)((0,m.if)(a),b),sessionAndToken:b}}}catch(a){throw(0,h.O)("getCurrentUser_IO ERROR",a),a}},v=async a=>{if(!a)return(0,h.O)("disableUser_IO NO INPUT DATA",a),null;try{let b=await o.X.use.user.update({where:{user_id:a.user_id},data:{is_active:!1,account:{update:{account_status:i.Nv.NOT_ACTIVE}},sessions:{deleteMany:{created_by_user_id:a.user_id}}},include:l.M});return(0,m.if)(b)}catch(a){throw(0,h.O)("disableUser_IO ERROR",a),a}},w=async a=>{if(!a)return(0,h.O)("enableUser_IO NO INPUT DATA",a),null;try{let b=await o.X.use.user.update({where:{user_id:a.user_id},data:{is_active:!0,account:{update:{account_status:k.L.utils.CAN_USER_HAVE_ACTIVE_ACCOUNT(a)?i.Nv.ACTIVE:void 0}}},include:l.M});return(0,m.if)(b)}catch(a){throw(0,h.O)("enableUser_IO ERROR",a),a}},x=async(a,b)=>{let c=p.c.includes(b);try{let d=await o.X.use.user.update({where:{user_id:a.user_id},data:{permissions:c?j.U.runtimePermissionsSetsForEvents.ACTIVE_ACCOUNT:[],account:{update:{account_status:b}}},include:l.M});if(!d)return null;return(0,m.if)(d)}catch(a){throw(0,h.O)("setAccountStateByPassedUser_IO ERROR",a),a}},y=async(a,b)=>{try{let c=await o.X.use.user.update({where:{user_id:a.user_id},data:{account:{update:{payment_status:i.kr.PAID,account_expiration_date:null,upcoming_payment_date:null,pricing_plan:b}}},include:l.M});if(!c)throw void 0;let{password:d,...e}=c;return e}catch(a){throw(0,h.O)("setPaymentStateByPassedUser_IO ERROR",a),a}}},4062:(a,b,c)=>{c.d(b,{O:()=>f});var d=c(483),e=c(5589);let f=(a,b,c="error")=>{let f=(0,d.getDateNowInString)(),g=`[ ${c.toUpperCase()} ${f} ] `;(console[c]([g,a,b]),(0,e.JS)())&&(console.log("Sending to error tracker:"),console.log({message:g+a,payload:b}))}},4205:(a,b,c)=>{c.d(b,{Dt:()=>j,o_:()=>l,q8:()=>k});var d=c(4062),e=c(8729),f=c(1224),g=c(444),h=c(1933),i=c(6031);let j=async(a,b=!1,c=!1,e=!1)=>{let{password:f}=a;if(c&&!f)return(0,d.O)("getUser - no password with password get-current enabled.",a,"warn"),null;let j=b?g.M:void 0,k=await i.X.use.user.findUnique({where:{...a,user_id:a?.user_id},include:j});return k?e?k:(0,h.if)(k):null},k=async a=>{let b=await i.X.use.user.create({data:{...a,role:e.Q0.ACCOUNT_HOLDER,account:{create:f.Uq}},include:g.M});return(0,h.if)(b)},l=async a=>{if(!a)throw void(0,d.O)("deleteUser_IO NO INPUT DATA",a);let b=await j({user_id:a},!0);if(!b)throw void(0,d.O)("deleteUser_IO NO USER FOUND",a);return await i.X.use.deletedUser.create({data:{user_id:a,body:JSON.stringify(b)}}),i.X.use.user.delete({where:{user_id:a}})}},4876:(a,b,c)=>{c.d(b,{B8:()=>l,F8:()=>m,PR:()=>n,hn:()=>o});var d=c(6293),e=c.n(d),f=c(4549),g=c.n(f),h=c(1394),i=c.n(h),j=c(3824),k=c.n(j);e().extend(k()),e().extend(g()),e().extend(i());let l=a=>e()(a),m=(a,b)=>e()(b).isSameOrAfter(a),n=()=>e()().utc().format(),o=a=>e()(a).utc().format()},5404:(a,b,c)=>{c.d(b,{$:()=>m,R:()=>k});var d=c(8729),e=c(7799);let f=Object.freeze({FREE:10,MONTHLY_1:1,MONTHLY_2:2,MONTHLY_3:3,ANNUAL_1:4,ANNUAL_2:5,ANNUAL_3:6});(0,e.X)(f);let g=Object.freeze({[f.FREE]:0,[f.MONTHLY_1]:30,[f.MONTHLY_2]:50,[f.MONTHLY_3]:100,[f.ANNUAL_1]:24,[f.ANNUAL_2]:40,[f.ANNUAL_3]:80});Array.from(Object.entries(g).keys());let h=Object.freeze({monthly:f.MONTHLY_2,annual:f.ANNUAL_3}),i="annual",j={utils:{GET_ANNUAL_DISCOUNT_PERCENTAGE:()=>"-30%",PRICING_PLAN_VALUE_TYPE_NARROWER:a=>!!a&&!!g[a],GET_DEFAULT_PRICING_PLANS_VALUE:a=>a?h[a]:h[i],GET_PRICING_PLAN_TYPE_BY_VALUE:a=>a?[1,2,3].includes(a)?"monthly":[4,5,6].includes(a)?"annual":i:i,GET_BESTSELLER_BY_PRICING_TYPE:a=>h[a]}},k=a=>{let{__isValid:b,...c}=a;return c},l=a=>Object.keys(a).every(b=>"__isValid"===b||!a[b]),m={utils:{validateEmail:a=>!!a&&!!a.match(/^([\w\d._\-#])+@([\w\d._\-#]+[.][\w\d._\-#]+)+$/),validateByMinLength:(a,b=3)=>!!a&&a.length>=b,validateByWhiteSpaces:a=>!!a&&!a.match(/\s+/g),normalizeStringEliminateWhitespaces:a=>a?a.trim().replace(/\s+/g,"").toLowerCase():"",normalizeStringCapitalizedWords:a=>a?a.replace(/[^\p{L}\s']/gu," ").replace(/\s+/g," ").trim().replace(/\b[\p{L}']+\b/gu,a=>a.replace(/(^|')[\p{L}]/gu,a=>a.toLocaleUpperCase())):""},validators:{userRegister:a=>{let b={__isValid:!1,__general:"",email:"",password:""};return m.utils.validateEmail(a?.email)||(b.email+="Check and enter correct email address. "),m.utils.validateByWhiteSpaces(a?.email)||(b.email+="Remove spaces from email. "),m.utils.validateByMinLength(a?.password,6)||(b.password+="Choose a more secure password - at least 6 characters. "),b.__isValid=l(b),b},checkEmail:a=>{let b={__isValid:!1,__general:"",email:""};return m.utils.validateEmail(a?.email)||(b.email+="Check and enter correct email address. "),m.utils.validateByWhiteSpaces(a?.email)||(b.email+="Remove spaces from email. "),b.__isValid=l(b),b},userCreate:a=>{let b={__isValid:!1,__general:"",email:""};return m.utils.validateEmail(a?.email)||(b.email+="Check and enter correct email address. "),m.utils.validateByWhiteSpaces(a?.email)||(b.email+="Remove spaces from email. "),b.__isValid=l(b),b},userLogin:a=>{let b={__isValid:!1,__general:"",email:"",password:""};return a.email||(b.email+="Enter email. "),a.password||(b.password+="Enter password. "),b.__isValid=l(b),b},deleteOrDisableSelfUser:a=>{let b={__isValid:!1,__general:"",password:""};return a.password||(b.password+="Enter password. "),b.__isValid=l(b),b},deleteOrDisableOtherUser:a=>{let b={__isValid:!1,__general:"",user_id:""};return 0===Object.keys(a).length&&(b.user_id+="No user identifier. "),b.__isValid=l(b),b},enableOtherUser:a=>{let b={__isValid:!1,__general:"",user_id:""};return 0===Object.keys(a).length&&(b.user_id+="No user identifier. "),b.__isValid=l(b),b},deleteSession:a=>{let b={__isValid:!1,__general:"",session_id:""};return a.session_id||(b.session_id+="Missing session ID. "),b.__isValid=l(b),b},accountDisplayNameChange:a=>{let b={__isValid:!1,__general:"",display_name:""};return a.display_name||(b.display_name+="Enter name. "),m.utils.validateByMinLength(a?.display_name,3)||(b.display_name+="Name must be longer than 3 characters. "),b.__isValid=l(b),b},accountPaymentMake:a=>{let b={__isValid:!1,__general:"",payment_id:"",pricing_plan:""};return a.pricing_plan||(b.pricing_plan+="Enter pricing plan. "),j.utils.PRICING_PLAN_VALUE_TYPE_NARROWER(a.pricing_plan)||(b.pricing_plan+="Enter valid pricing plan. "),a.payment_id||(b.payment_id+="Enter payment ID. "),b.__isValid=l(b),b},eventLogGetAll:a=>{let b={__isValid:!1,__general:"",type:""};return a.type||(b.type+="Missing logs type. "),Object.values(d.aU).includes(a.type)||(b.type+="Wrong logs type. "),b.__isValid=l(b),b},createGalleryRecord:a=>{let b={__isValid:!1,__general:"",asset_url:"",traits:"",color_traits:""};return a.asset_url||(b.asset_url+="Missing asset url to upload. "),0===a.traits.length&&(b.traits+="Add at least one trait. "),0===a.color_traits.length&&(b.color_traits+="Add at least one color trait. "),b.__isValid=l(b),b},getGalleryRecords:a=>{let b={__isValid:!1,__general:"",asset_traits:"",asset_color_traits:"",apply_strict_filter:"",gallery_record_id:""};return Array.isArray(a.asset_traits)||(b.asset_traits+="Wrong payload type. Required array. "),Array.isArray(a.asset_color_traits)||(b.asset_color_traits+="Wrong payload type. Required array. "),b.__isValid=l(b),b},deleteAssetFromVendor:a=>{let b={__isValid:!1,__general:"",asset_id:""};return a.asset_id||(b.asset_id+="No ID of asset. "),b.__isValid=l(b),b}}}},5589:(a,b,c)=>{c.d(b,{h3:()=>g,JS:()=>f});var d=c(483);let e={JWT_SALT:process.env.JWT_SALT,HTTP_PROTOCOL:"http://",HTTP_WEB1_APP_HOST:"192.168.1.34",HTTP_MAIN_APP_HOST:process.env.HTTP_MAIN_APP_HOST,PORT_MAIN:process.env.PORT_MAIN},f=()=>!0,g=(()=>{if(Object.keys(e).every(a=>(0,d.isStringTypeNarrower)(a)))return e;throw console.error("WARNING"),console.warn("WARNING"),console.error("WARNING"),console.warn("WARNING"),Error("!!! NOT VALID ENV CONFIG !!!")})()},6214:(a,b,c)=>{c.d(b,{BM:()=>m,Q7:()=>k,xN:()=>l});var d=c(2429),e=c(4062),f=c(9195),g=c(7512),h=c(9617),i=c(1596),j=c(6357);let k=a=>{try{if(!a||!(0,i.yh)(a))return void(0,e.O)("createToken PAYLOAD ERROR",a);let b=String(Date.now()),c=(0,g.s)(a,b);if(!c)return void(0,e.O)("TOKEN NOT CREATED",a);return(0,i.mx)(c,b)}catch(a){throw(0,e.O)("createToken ERROR",a),a}},l=async a=>{try{(0,f.dy)({...a,payload:{name:h.f,value:j.V}})}catch(a){throw(0,e.O)("deleteSessionToken ERROR",a),a}},m=async a=>{try{let b=await (0,f.nV)({...a,payload:h.f});return(0,d.BP)(()=>console.log("getExtendedEncodedToken, string output length: ",b?.length)),b}catch(a){throw(0,e.O)("getExtendedEncodedToken ERROR",a),a}}},6289:(a,b,c)=>{c.d(b,{L:()=>f});var d=c(1775),e=c(8729);let f={utils:{IS_USER_HAS_ACTIVE_ACCOUNT:a=>void 0!==a&&!!a&&!!a.account&&!!d.c.includes(a.account.account_status),IS_USER_NEED_TO_PAY_TO_ACTIVATE_ACCOUNT:a=>a?.account?.account_status===e.Nv.NOT_ACTIVE&&a.account.payment_status===e.kr.UNPAID,IS_USER_ACTIVE:a=>!!a?.is_active,CAN_USER_HAVE_ACTIVE_ACCOUNT:a=>a?.account?.payment_status===e.kr.PAID}}},6357:(a,b,c)=>{c.d(b,{V:()=>d});let d="clearme"},6459:(a,b,c)=>{c.d(b,{C:()=>g});var d=c(4062),e=c(9195),f=c(6214);let g=(a,b)=>{let{payload:c,req:g}=a;if(!c)return void(0,d.O)("generateSessionTokenAndSet NO PAYLOAD",{payload:c,req:g});let h=(0,f.Q7)(c);return h?((0,e.dy)({...a,payload:{name:b,value:h}}),{extendedToken:h,decodedToken:c}):void(0,d.O)("generateSessionTokenAndSet NO TOKEN",{payload:c})}},7223:(a,b,c)=>{c.d(b,{XQ:()=>w,h7:()=>x});var d=c(483),e=c(6293),f=c.n(e),g=c(9061),h=c.n(g),i=c(1933),j=c(2562),k=c(4876),l=c(637),m=c(8729),n=c(2429),o=c(4062),p=c(8923),q=c(9617),r=c(6459),s=c(6214),t=c(1596),u=c(1314),v=c(6031);let w=async(a,b=m.JW.STANDARD)=>{let{payload:c,req:e,res:f}=a;if(!c)throw void(0,o.O)("generateSessionAndSetToken NO PAYLOAD",{payload:c,req:e});let{user_id:g,user_agent:j,language:k}=c,l=c?.client_ip??h().getClientIp(e);try{let a=await (0,i.t)({client_ip:l,language:k,user_agent:j}),h=(0,p.to)(),m=await v.X.use.session.create({data:{session_mode:b,client_ip:a.client_ip,location:a.location,user_agent:a.user_agent,language:a.language,expires_at:h,created_by_user:{connect:{user_id:g}}}}),n={user_id:g,created_at:(0,d.getDateNowInString)({withTimestamp:!0}),client_ip:a.client_ip??null,location:a.location??null,user_agent:a.user_agent??null,language:a.language??null,session_id:m.session_id,expires_at:h},s=(0,r.C)({req:e,res:f,payload:n},q.f);if(!s)throw void(0,o.O)("generateSessionAndSetToken NO TOKEN",c);return{session:m,token:s}}catch(a){throw(0,o.O)("generateSessionAndSetToken",a),a}},x=async(a,b=!1)=>{let c=await (0,s.BM)(a);if(!c)return(0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO NO extendedToken - return null.")),null;(0,n.BP)(()=>console.log(`getAndRefreshCurrentSessionAndToken_IO extendedToken length: ${c.length}`));try{let d,e=(0,t.V)(c),g=e.decodedToken;if((0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO decodedToken:")),(0,n.BP)(()=>console.log(g)),(0,n.BP)(()=>console.log(JSON.stringify(g,null,2))),!g)return(0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO NO decodedToken - return null.")),null;let h=await (0,u.C$)({session_id:g.session_id});if((0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO sessionFromFoundUser, session_id: ",h?.session_id)),!h)return null;if((a=>a?(0,k.F8)(f()(a)):null)(h.expires_at))throw await (0,j.td)({...a,payload:{user_id:h.created_by_user_id,session_id:h.session_id}}),(0,l.e)({event:"SESSION_EXPIRED",data:void 0});let i=(0,p.G8)(g.expires_at),m=b||i,w=(0,p.to)();(0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO ifTokenAndSessionShouldBeRefreshedByElapsedTime: ",i)),(0,n.BP)(()=>console.log("getAndRefreshCurrentSessionAndToken_IO ifTokenAndSessionShouldBeRefreshed: ",m));let x=await v.X.use.session.update({where:{session_id:h.session_id},data:{last_used:(0,k.PR)(),expires_at:m?w:void 0}});if(m){let b=(0,p.BG)(g);if(await (0,s.xN)(a),d=(0,r.C)({...a,payload:{...b,expires_at:w}},q.f),void 0===d)return(0,o.O)("getAndUpdateRefreshedSessionAndToken newToken NO TOKEN",d),null}return{session:x,token:m?d:e}}catch(b){if(b?.code==="P2025")return null;throw(0,o.O)("getCurrentSessionAndToken",b),await (0,s.xN)(a),b}}},7512:(a,b,c)=>{c.d(b,{G:()=>i,s:()=>h});var d=c(829),e=c(2429),f=c(4062),g=c(1596);let h=(a,b)=>{let c=(0,g.CT)(b);if((0,e.BP)(()=>console.log("JWT_SIGN. fullSalt length: ",c?.length)),void 0!==c)try{return d.sign(a,c)}catch(a){throw(0,f.O)("JWT_SIGN",a),a}},i=(a,b)=>{let c=(0,g.CT)(b);if((0,e.BP)(()=>console.log("JWT_VERIFY. fullSalt type: ",typeof c)),(0,e.BP)(()=>console.log("JWT_VERIFY. encodedToken type: ",typeof a)),void 0!==c)try{return d.verify(a,c)}catch(a){if("TokenExpiredError"===a.name)return;throw(0,f.O)("JWT_VERIFY",a),a}}},7767:(a,b,c)=>{c.d(b,{w:()=>x});var d=c(2429),e=c(4062),f=c(637),g=c(1620),h=c(4476),i=c(5404),j=c(4876),k=c(8729),l=c(6289),m=c(2562);let n=async a=>{if(!a||!a.account)return(0,e.O)("accountExpiringInterceptor NO INPUT DATA",a),a;if(!l.L.utils.IS_USER_HAS_ACTIVE_ACCOUNT(a))return a;let b=a.account.account_expiration_date;if(b){if((0,j.F8)((0,j.B8)(b))){if(a.account.payment_status===k.kr.PAID)(0,e.O)("USER HAS PAID ACCOUNT, BUT DATE OF ACCOUNT EXPIRED!!! Bug detected.",a,"error");else if(a.account.account_status!==k.Nv.EXPIRED)return await (0,m.iP)(a,k.Nv.EXPIRED)??a}else if(a.account.account_status!==k.Nv.EXPIRING_IN_PROGRESS)return await (0,m.iP)(a,k.Nv.EXPIRING_IN_PROGRESS)??a}return a},o=async a=>{if(!a)return null;let b=await n(a);return b?{...a,...b}:a};var p=c(261),q=c(9369),r=c(5589);let s=[`${r.h3.HTTP_PROTOCOL}${r.h3.HTTP_MAIN_APP_HOST}:${r.h3.PORT_MAIN}`,`${r.h3.HTTP_PROTOCOL}${r.h3.HTTP_MAIN_APP_HOST}`],t=Object.freeze({"Access-Control-Allow-Methods":"GET, POST","Access-Control-Allow-Headers":"Content-Type, Pathname, Cache-Control, Accept, Pragma, Refferer, Upgrade-Insecure-Requests, "+Object.values(q.R).join(", "),"Access-Control-Expose-Headers":Object.values(q.R).join(", "),"Access-Control-Allow-Credentials":"true"}),u=Object.keys(t),v=Object.values(t);var w=c(6031);let x=async(a,b,c)=>{let{allowedHTTPMethod:j,eventName:k,validationFunction:l=c.validationFunction??(()=>({__isValid:!0})),businessLogic:n,AUTHENTICATION_CHECK_ENABLED:q=!0}=c;if(!(({req:a})=>{let b=a.headers?.origin??"";return s.includes(b)})({req:a,res:b}))return void b.status(406).end();if((({req:a,res:b})=>{let c=a.headers?.origin??"";b.setHeader("Access-Control-Allow-Origin",c);for(let a=0;a<u.length;a++)b.setHeader(u[a],v[a])})({req:a,res:b}),"OPTIONS"===a.method)return void b.status(200).end();if((0,d.BP)(()=>console.log("HTTPRequestHandlerMiddleware",`eventName: ${k}`,`sessionAndPermissionEventCheck: ${q}`)),a.method?.toUpperCase()!==j.toUpperCase())return void b.status((0,f.G)(405)).send(null);let{body:r}=a,t=l(r);if(!t.__isValid)return void b.status((0,f.G)(406)).send((0,f.e)({event:"VALIDATION_FAILED",data:(0,i.R)(t)}));try{let c=m.uQ;if(q&&(c=await (0,m.mg)({req:a,res:b}),!h.U.utils.GET_PERMISSION_APPROVAL_FOR_EVENT(c.user,k)))return void b.status((0,f.G)(401)).json((0,f.e)({event:c.user?"UNAUTHORIZED":"LOGIN_FIRST",data:void 0}));if(c&&await o(c.currentUser),!(({req:a,res:b,payload:c})=>{let d=a.headers.pathname;return h.U.utils.GET_PERMISSION_APPROVAL_FOR_ROUTE_WITH_CALLBACKS({currentPathname:d,currentUser:c,userExistsIsStaticPageCallback:a=>{b.status((0,f.G)(200)).json((0,f.e)({event:"ALREADY_LOGGED",data:a}))},userExistsIsNotStaticPageCallback:a=>{b.status((0,f.G)(401)).json((0,f.e)({event:"UNAUTHORIZED",data:a}))},userNotExistsCallback:()=>{b.status((0,f.G)(401)).json((0,f.e)({event:"LOGIN_FIRST",data:void 0}))}})})({req:a,res:b,payload:c.currentUser}))return;let{userMetadata:e}=(0,p.V)(a);(0,d.BP)(()=>console.log("HTTPRequestHandlerMiddleware","Firing business logic...")),await n(r,c,e),(0,d.XI)(async()=>{(0,d.kT)(async()=>{let a=await w.X.use.$metrics.json();console.dir(a.counters),console.log(" "),console.dir(a.gauges)},"DB LEAKS DEBUG")})}catch(a){if(g.x.utils.IS_INFO_EVENT(a.event))return void b.status((0,f.G)(401)).json((0,p.a)(a.event,a));(0,e.O)(`HTTPRequestHandlerMiddleware [${k}]`,a),b.status((0,f.G)(500)).json((0,p.a)("GENERAL_ERROR",void 0))}}},8923:(a,b,c)=>{c.d(b,{G8:()=>f,to:()=>e,BG:()=>g});var d=c(4876);let e=()=>(0,d.B8)().add(57600,"second").utc().format(),f=a=>(0,d.F8)((0,d.B8)(a),(0,d.B8)().add(28800,"second")),g=a=>{let{exp:b,iat:c,...d}=a;return d}},9195:(a,b,c)=>{c.d(b,{dy:()=>f,nV:()=>g});var d=c(2429),e=c(4062);let f=a=>{let{res:b,payload:c}=a;if(!c)return void(0,e.O)("setClientHeader, no payload.",c);(0,d.BP)(()=>console.log("setClientHeader payload.name and value length: ",c.name,c.value?.length)),(0,d.BP)(()=>console.log("setClientHeader typeof payload.value: ",typeof c.value)),b.setHeader(c.name,c.value)},g=async a=>{let{req:b,res:c,payload:e}=a;if((0,d.BP)(()=>console.log("getClientHeader payload: ",e)),!e)return null;let f=b.headers[e];return((0,d.BP)(()=>console.log("getClientHeader string output length: ",f?.length,"header name: ",e)),f&&void 0!==f)?f:null}},9617:(a,b,c)=>{c.d(b,{f:()=>d,u:()=>e});let d=c(9369).R.authorization,e=".eyJ1c2VyX2lkIjoiY20zcmYxdG9kMDAwMnA5emhyN2JoZXlmMiIsImNyZWF0ZWRfYXQiOiJbMTczMjYzNzA2OTUwOF0gMjAyNC0xMS0yNlQxNjowNDoyOS41MDhaIiwiY2xpZW50X2lwIjoiODMuMjkuMTYuMzQiLCJsb2NhdGlvbiI6IlBMLCBLcmFrb3cuIFRpbWV6b25lOiBFdXJvcGUvV2Fyc2F3IiwidXNlcl9hZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb31706859"}};